<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" font-family="system-ui, -apple-system, sans-serif" font-size="13">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="600" fill="#fafafa" rx="8"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-size="18" font-weight="bold" fill="#0f172a">Agent Integrity Protocol — Architecture</text>

  <!-- Agent Turn N -->
  <rect x="330" y="55" width="140" height="32" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="400" y="76" text-anchor="middle" font-weight="600" fill="#1e40af">Agent Turn N</text>
  <line x1="400" y1="87" x2="400" y2="108" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Layer 1: Extraction -->
  <rect x="60" y="110" width="680" height="120" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="80" y="133" font-weight="bold" fill="#166534">Layer 1: Thinking Block Extraction</text>

  <rect x="90" y="145" width="140" height="65" rx="6" fill="white" stroke="#86efac" stroke-width="1"/>
  <text x="160" y="167" text-anchor="middle" font-weight="600" fill="#166534">Anthropic</text>
  <text x="160" y="183" text-anchor="middle" font-size="11" fill="#475569">thinking blocks</text>
  <text x="160" y="199" text-anchor="middle" font-size="11" fill="#16a34a">conf: 1.0</text>

  <rect x="250" y="145" width="140" height="65" rx="6" fill="white" stroke="#86efac" stroke-width="1"/>
  <text x="320" y="167" text-anchor="middle" font-weight="600" fill="#166534">OpenAI</text>
  <text x="320" y="183" text-anchor="middle" font-size="11" fill="#475569">reasoning_content</text>
  <text x="320" y="199" text-anchor="middle" font-size="11" fill="#16a34a">conf: 0.9</text>

  <rect x="410" y="145" width="140" height="65" rx="6" fill="white" stroke="#86efac" stroke-width="1"/>
  <text x="480" y="167" text-anchor="middle" font-weight="600" fill="#166534">Google</text>
  <text x="480" y="183" text-anchor="middle" font-size="11" fill="#475569">gemini thinking</text>
  <text x="480" y="199" text-anchor="middle" font-size="11" fill="#16a34a">conf: 0.9</text>

  <rect x="570" y="145" width="140" height="65" rx="6" fill="white" stroke="#86efac" stroke-width="1"/>
  <text x="640" y="167" text-anchor="middle" font-weight="600" fill="#166534">Fallback</text>
  <text x="640" y="183" text-anchor="middle" font-size="11" fill="#475569">regex extraction</text>
  <text x="640" y="199" text-anchor="middle" font-size="11" fill="#f59e0b">conf: 0.3</text>

  <line x1="400" y1="230" x2="400" y2="258" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Layer 2: Analysis -->
  <rect x="60" y="260" width="680" height="120" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="80" y="283" font-weight="bold" fill="#1e40af">Layer 2: Integrity Analysis Engine</text>

  <rect x="90" y="295" width="200" height="65" rx="6" fill="white" stroke="#93c5fd" stroke-width="1"/>
  <text x="190" y="317" text-anchor="middle" font-weight="600" fill="#1e40af">Conscience Prompt</text>
  <text x="190" y="333" text-anchor="middle" font-size="11" fill="#475569">Card + Values + Window</text>
  <text x="190" y="349" text-anchor="middle" font-size="11" fill="#475569">+ Thinking Block</text>

  <line x1="290" y1="327" x2="330" y2="327" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <rect x="335" y="295" width="180" height="65" rx="6" fill="white" stroke="#93c5fd" stroke-width="1"/>
  <text x="425" y="317" text-anchor="middle" font-weight="600" fill="#1e40af">Analysis LLM</text>
  <text x="425" y="333" text-anchor="middle" font-size="11" fill="#475569">e.g. Claude Haiku</text>
  <text x="425" y="349" text-anchor="middle" font-size="11" fill="#475569">~1-3s latency</text>

  <line x1="515" y1="327" x2="545" y2="327" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <rect x="550" y="295" width="170" height="65" rx="6" fill="white" stroke="#93c5fd" stroke-width="1"/>
  <text x="635" y="317" text-anchor="middle" font-weight="600" fill="#1e40af">Checkpoint</text>
  <text x="635" y="333" text-anchor="middle" font-size="11" fill="#475569">verdict + concerns</text>
  <text x="635" y="349" text-anchor="middle" font-size="11" fill="#475569">+ metadata</text>

  <line x1="400" y1="380" x2="400" y2="408" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Layer 3: Signal Delivery -->
  <rect x="60" y="410" width="680" height="110" rx="8" fill="#fefce8" stroke="#eab308" stroke-width="1.5"/>
  <text x="80" y="433" font-weight="bold" fill="#854d0e">Layer 3: Signal Delivery</text>

  <rect x="90" y="448" width="190" height="52" rx="6" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="185" y="470" text-anchor="middle" font-weight="600" fill="#166534">clear</text>
  <text x="185" y="488" text-anchor="middle" font-size="11" fill="#166534">proceed → continue</text>

  <rect x="305" y="448" width="190" height="52" rx="6" fill="#fef9c3" stroke="#eab308" stroke-width="1.5"/>
  <text x="400" y="470" text-anchor="middle" font-weight="600" fill="#854d0e">review_needed</text>
  <text x="400" y="488" text-anchor="middle" font-size="11" fill="#854d0e">proceed → log + warn</text>

  <rect x="520" y="448" width="190" height="52" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
  <text x="615" y="470" text-anchor="middle" font-weight="600" fill="#991b1b">boundary_violation</text>
  <text x="615" y="488" text-anchor="middle" font-size="11" fill="#991b1b">block → escalate</text>

  <line x1="400" y1="520" x2="400" y2="548" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Agent Turn N+1 -->
  <rect x="330" y="550" width="140" height="32" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="400" y="571" text-anchor="middle" font-weight="600" fill="#1e40af">Agent Turn N+1</text>
</svg>
